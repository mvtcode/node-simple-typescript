**Tích hợp cloud mongodb cho RAG**

**1) Tổng quan**

RAG kết hợp với mongodb cloud để làm vector db, sử dụng code nodejs để test.

**2) Setup mongodb cloud**

Trong tài khoản của tôi plan Free, nói chung là tài khoản nào cũng có thể sử dụng được!

**Chú ý**: mongodb selfhost đang không hỗ trợ (tính đến nay ngày 27/11/2025)

![Hình ảnh](https://rag-docx.hpscamera.com/images/178a1b88-ac14-49ba-8d8d-94422647fa8f/57281bd5-a896-42b5-8423-15ed13261cb0.png)

**Mô tả hình ảnh:**
This image displays the options for upgrading a MongoDB Cluster named 'Cluster0'. It presents three types of plans: M10, Flex, and Free, with each having different pricing, storage, RAM, and features.

**Dữ liệu bảng từ ảnh:**
| Plan | Price | Description | Storage | RAM | vCPU | Features |
|------|-------|-------------|---------|-----|------|----------|
| M10  | $0.10/hour, Starts at $72/month | Dedicated Clusters for development environments and low-traffic applications. | 10 GB | 2 GB | 0.5 vCPUs | Flexible backups, Zero-downtime cluster auto-scaling, Performance diagnostic tools, Additional search indexes, Uptime SLA |
| Flex | From $0.011/hour, Up to $30/month | For application development and testing, with on-demand burst capacity for unpredictable traffic. | 5 GB | Shared | Shared | Basic backups, Upgradeable, Pay As You Go pricing, On-demand burst capacity |
| Free | N/A | For learning and exploring MongoDB in a cloud environment. | 512 MB | Shared | Shared | Free forever |

**Giá trị RAG:** This image helps answer the question about different pricing and configuration options available for upgrading a MongoDB Cluster, which is relevant when setting up MongoDB Cloud as a part of a RAG system.

**Văn bản trong ảnh (OCR):**
- Upgrade Cluster0
- Choose a template below to upgrade your cluster or edit additional configuration.
- Cluster configuration can be edited at any time.
- M10
- $0.10/hour
- Starts at $72/month
- RECOMMENDED
- Dedicated Clusters for development environments and low-traffic applications.
- STORAGE
- 10 GB
- RAM
- 2 GB
- vCPU
- 0.5 vCPUs
- Features
- Flexible backups
- Zero-downtime cluster auto-scaling
- Performance diagnostic tools
- Additional search indexes
- Uptime SLA
- Flex
- From $0.011/hour
- Up to $30/month
- MINIMUM UPGRADE
- For application development and testing, with on-demand burst capacity for unpredictable traffic.
- STORAGE
- 5 GB
- RAM
- Shared
- vCPU
- Shared
- Features
- Basic backups
- Upgradeable
- Pay As You Go pricing
- On-demand burst capacity
- Free
- CURRENT
- For learning and exploring MongoDB in a cloud environment.
- STORAGE
- 512 MB
- RAM
- Shared
- vCPU
- Shared
- Features
- Free forever

Tôi có database: **ai-study** và collections: **rag**.

Hiện tại chưa có dữ liệu và index.

![Hình ảnh](https://rag-docx.hpscamera.com/images/178a1b88-ac14-49ba-8d8d-94422647fa8f/ad2ecae0-64cb-425d-b9ea-28e7e4853232.png)

**Mô tả hình ảnh:**
Ảnh chụp màn hình giao diện của một công cụ quản lý cơ sở dữ liệu. Phần bên phải thể hiện thông tin chi tiết của database 'ai-study' và collection 'rag'. Có các mục như Find, Indexes, Schema Anti-Patterns và Aggregation. Ảnh cũng cho thấy các lựa chọn như Filter, Apply dành cho truy vấn, và kích thước của dữ liệu.

**Giá trị RAG:** Hình ảnh này minh họa bước chuẩn bị khi thiết lập dữ liệu và index trong một database có tên là 'ai-study' và collection 'rag' trong hệ thống RAG, công cụ đang sử dụng cho quá trình tìm kiếm và thao tác dữ liệu.

**Văn bản trong ảnh (OCR):**
- Data
- Cluster0
- DATABASES: 1
- COLLECTIONS: 1
- + Create Database
- Search Namespaces
- ai-study
- rag
- ai-study.rag
- STORAGE SIZE: 36KB
- LOGICAL DATA SIZE: 82B
- TOTAL DOCUMENTS: 1
- INDEXES TOTAL
- Find
- Indexes
- Schema Anti-Patterns
- Aggregation
- Generate queries from natural language in Compass
- Filter
- Type a query: { field: 'value' }
- QUERY RESULTS: 0
- PREVIEW
- New Data Explorer
- VERSION
- 8.0.16
- REGION
- GCP Singapore (asia-southeast1)
- VISUALIZE YOUR DATA
- REFRESH
- INSERT DOCUMENT
- Reset
- Apply
- Options

Schema tôi muốn setup cho RAG đơn giản như sau:

{

\_id: ObjectId,

content: string,

embedding: double\[\],

}

Ok, bắt đầu vào thiết lập.

Ở menu bên trái, chọn **Search & Vector Search**

![Hình ảnh](https://rag-docx.hpscamera.com/images/178a1b88-ac14-49ba-8d8d-94422647fa8f/dcce2285-8d87-45cf-9e1f-f83b14f44078.png)

**Mô tả hình ảnh:**
Ảnh chụp màn hình của một giao diện người dùng cho việc tạo chỉ mục tìm kiếm vector. Giao diện hiển thị các tùy chọn và nút để thực hiện thao tác trên dữ liệu với các tính năng liên quan đến tìm kiếm và chỉ mục.

**Giá trị RAG:** Hình ảnh này giúp người dùng định vị vị trí trong giao diện để bắt đầu quá trình tạo chỉ mục tìm kiếm hoặc chỉ mục tìm kiếm vector trong hệ thống RAG.

**Văn bản trong ảnh (OCR):**
- Search & Vector Search
- Create Search Index
- Create Vector Search Index

Tiếp chọn **Create Search Index** hoặc chọn nhanh **Create Vector Search Index**

![Hình ảnh](https://rag-docx.hpscamera.com/images/178a1b88-ac14-49ba-8d8d-94422647fa8f/84a5e846-7dba-480e-8535-c0b18cc1bb12.png)

**Mô tả hình ảnh:**
The image displays the configuration interface for creating a new search index. It allows users to choose between 'Atlas Search' for full-text search and 'Vector Search' for semantic search and AI applications. The screenshot indicates the option for 'Vector Search' is selected. The user can also define the index name and data source, with warnings regarding time series collections and missing vector embeddings. The interface provides options to configure the index using a 'Visual Editor' or 'JSON Editor'. A sample database and collection are shown, with 'rag' selected.

**Giá trị RAG:** The image helps answer how to start the configuration of a vector search index, including choosing search type, naming the index, selecting a database/collection, and configuration methods.

**Văn bản trong ảnh (OCR):**
- Start Your Index Configuration
- Search Type
- Which Search type should I use?
- Atlas Search
- Full-text search for relevance-based app features.
- Vector Search
- For semantic search and AI applications.
- Index Name and Data Source
- Search indexes are specific to a database and collection.
- At this time, search indexes cannot be created for time series collections.
- Index Name
- vector_index
- No vector embeddings were detected in this collection. You can still create the index now and load the embeddings later. Learn more about generating embeddings
- Database and Collection
- ai-study
- rag
- Configuration Method
- Select how you would like to configure your index. You can also define indexes through the Atlas Admin API, Atlas CLI, MongoDB Shell, or supported Drivers.
- Visual Editor
- Define index definitions in a more guided experience.
- JSON Editor
- Edit the raw index definition with an embedded JSON editor.
- Cancel
- Next

Chọn như trên hình và chọn Next

![Hình ảnh](https://rag-docx.hpscamera.com/images/178a1b88-ac14-49ba-8d8d-94422647fa8f/5acf1db1-e278-4ca0-b23a-b6deafeaeaa4.png)

**Mô tả hình ảnh:**
undefined

Các thông số chọn như sau:  
Vector Field:

*   Path: là **embedding**
*   Number of Dimensions: **1536**, tôi sử dụng model text-embedding-3-small có 1536 chiều, sử dụng model khác thì cần hiểu rõ để nhập tương ứng. Ví dụ model embedding của OpenAI:  
    \+ text-embedding-ada-002: 1536  
    \+ text-embedding-3-large: 3072 | 256 | 1024  
    \+ text-embedding-3-small: 1536 | 512
*   Similarity Method: **cosine**

Filter Field:

*   Path: rỗng, phần này chia category để sử dụng cho RAG nhiều phần khác nhau.

Xong chọn **Next** và review dữ liệu vừa nhập rồi chọn **Create Vector Search Index**

![Hình ảnh](https://rag-docx.hpscamera.com/images/178a1b88-ac14-49ba-8d8d-94422647fa8f/e6719cfa-9f4b-490a-8318-6fa4cc67eb80.png)

**Mô tả hình ảnh:**
Ảnh này là một ảnh chụp màn hình giao diện người dùng (UI) hiển thị các tùy chọn cấu hình cho embedding vectors. Tên các model và số chiều của chúng được liệt kê rõ ràng.

**Giá trị RAG:** Hình ảnh này giúp minh họa cách thiết lập thông số cho embedding vectors trong một hệ thống RAG.

**Văn bản trong ảnh (OCR):**
- Select Embedding Model
- Model Name
- Number of Dimensions
- text-embedding-3-small
- 1536
- text-embedding-ada-002
- 1536
- text-embedding-3-large
- 30

Dữ liệu JSON sau khi config:

{

"fields": \[

{

"type": "vector",

"path": "embedding",

"similarity": "cosine",

"numDimensions": 1536

}

\]

}

![Hình ảnh](https://rag-docx.hpscamera.com/images/178a1b88-ac14-49ba-8d8d-94422647fa8f/f60b539d-9840-4874-a2f1-b31066e5a1dd.png)

**Mô tả hình ảnh:**
Ảnh hiển thị giao diện quản lý cho tính năng Tìm kiếm & Vector Search trong một ứng dụng quản lý dữ liệu. Nó cho thấy danh sách chỉ mục tìm kiếm vector đang hoạt động với các thông tin chi tiết như Database, Collection, Tên chỉ mục, Trạng thái, Khả năng truy vấn, Kiểu, Trường chỉ mục, số lượng tài liệu và kích thước.

**Dữ liệu bảng từ ảnh:**
| Database | Collection | Index Name   | Status | Queryable | Type        | Index Fields | Documents (Estimated) | Size   | Required Memory | Actions |
|----------|------------|--------------|--------|-----------|-------------|--------------|-----------------------|--------|-----------------|---------|
| ai-study | rag        | vector_index | READY  | ✔         | vectorSearch| "embedding"  | 5 (100%) indexed of 5 | 45.16KB| 45.16KB         | QUERY   |

**Giá trị RAG:** Hình ảnh này cho thấy thông tin về giới hạn số lượng chỉ mục trong gói Plan M0 Free và chi tiết về một chỉ mục vector đã được tạo, phù hợp với phần tạo chỉ mục trong tài liệu.

**Văn bản trong ảnh (OCR):**
- Search & Vector Search
- M0 free clusters have a limit of 3 search and vector indexes per cluster. Indexes Used: 1 of 3.
- Database
- Collection
- Index Name
- Status
- Queryable
- Type
- Index Fields
- Documents (Estimated)
- Size
- Required Memory
- Actions
- ai-study
- rag
- vector_index
- READY
- View status details
- vectorSearch
- "embedding"
- 5 (100%) indexed of 5
- 45.16KB
- 45.16KB
- QUERY
- VIEW COMPOUND QUERY EXAMPLE
- CREATE SEARCH INDEX

Tạo xong thì thấy thông báo Plan M0 Free được tạo 3 search và vector indexes trên 1 cluster. Mình tạo được 1 là đủ test rồi.

Xem query sử dụng như thế nào:

![Hình ảnh](https://rag-docx.hpscamera.com/images/178a1b88-ac14-49ba-8d8d-94422647fa8f/497d91f4-cf85-4f28-b8db-3609963e23d2.png)

**Mô tả hình ảnh:**
Hình ảnh này hiển thị một giao diện người dùng của một công cụ quản lý cơ sở dữ liệu với một cửa sổ pop-up xuất hiện ở giữa. Cửa sổ pop-up có tiêu đề 'View Query Syntax' và hướng dẫn người dùng cách thực hiện một truy vấn $vectorSearch trong MongoDB bằng cách kết nối với shell MongoDB và sử dụng một pipeline tổng hợp.

**Dữ liệu bảng từ ảnh:**
| Database | Collection | Index Name    | Status | Index Fields | Documents (Estimated) | Size   | Required Memory |
|----------|------------|---------------|--------|--------------|-----------------------|--------|-----------------|
| ai-study | rag        | vector_index  | READY  | embedding    | 5 (100%) indexed of 5 | 45.15KB| QUERY           |

**Giá trị RAG:** Hình ảnh này mô tả cách thực hiện một truy vấn $vectorSearch trong MongoDB, hỗ trợ trong việc tạo và xử lý các index vector để thực hiện tìm kiếm trong cơ sở dữ liệu.

**Văn bản trong ảnh (OCR):**
- M0 free clusters have a limit of 3 search and vector indexes per cluster. Indexes Used: 1 of 3.
- Database
- Collection
- Index Name
- Status
- Queryable
- Type
- Index Fields
- Documents (Estimated)
- Size
- Required Memory
- Actions
- ai-study
- rag
- vector_index
- READY
- embedding
- 5 (100%) indexed of 5
- 45.15KB
- QUERY
- View status details
- Learn more about Atlas Search
- Learn more about Atlas Vector Search
- View Query Syntax
- To execute the full $vectorSearch query, connect to the mongo shell, and copy the code below into an aggregation pipeline. You can also use aggregation pipeline in Data Explorer Collections tab or in Compass. Learn more about $vectorSearch
- 1 db.rag.aggregate([
- {
- "$vectorSearch": {
- "index": "vector_index",
- "path": "embedding",
- "queryVector": [<array-of-numbers>],
- "numCandidates": <number-of-candidates>,
- "limit": <number-of-results>
- }
- }
- ])
- Close

**Chú ý:**

*   score results tự động sort DESC nên không cần sort lại ở aggregate.

Query hoàn chỉnh mẫu:

db.rag​​.aggregate(\[

{

$vectorSearch: {

index: 'vector\_index',

path: 'embedding',

queryVector: \[0.1,......\], // vector query được tạo từ OpenAI qua model text-embedding-3-small (Chú ý: lúc insert và so sánh cùng model embedding)

numCandidates: 100, // càng cao càng chính xác

limit: 5, // lấy 5 bản ghi có score cao nhất

},

},

{

$project: {

content: 1,

score: { $meta: 'vectorSearchScore' },

},

},

\]);

Output:

\[

{

\_id: new ObjectId('6927cc753d45494cbe14bd78'),

content: 'uống cạnh máy.• Không che chắn khe tản nhiệt khi dùng.14. Backup…',

score: 0.801313042640686

},

{

\_id: new ObjectId('6927cc753d45494cbe14bd75'),

content: 'Hướng Dẫn Sử Dụng Máy Tính Windows Cơ Bản Máy tính Windows…',

score: 0.7920860052108765

},

{

\_id: new ObjectId('6927cc753d45494cbe14bd79'),

content: 'đầu sử dụng máy tính Windows hiệu quả. Hãy luyện tập thường xuyên…',

score: 0.7809633016586304

}

\]

**3) Tham khảo các database khác có hỗ trợ vector (ChatGPT)**

*   Milvus — open-source, rất phù hợp với dữ liệu vector quy mô lớn (mấy chục triệu → hàng tỉ vectơ), hỗ trợ indexing hiệu quả (HNSW, IVF...) và cả GPU.
*   Qdrant — open-source, hỗ trợ tìm kiếm tương đồng (similarity search), realtime update, phù hợp nếu bạn cần dynamic data + vector search.
*   Weaviate — open-source, hỗ trợ “hybrid search” (vector + keyword/metadata), có thể kết hợp tìm kiếm ngữ nghĩa — phù hợp nếu bạn có embedding + metadata / text.
*   Chroma (Chroma DB) — nhẹ, dễ deploy, phù hợp với các dự án nhỏ, prototyping, thử nghiệm hoặc ứng dụng LLM/embedding cơ bản.
*   Faiss — đúng hơn là thư viện vector-search rather than full DB: thuận tiện nếu bạn chỉ cần tìm kiếm các vector embedding — thích hợp cho nghiên cứu, xử lý offline, hoặc dùng kết hợp trong pipeline ML.
*   pgvector — extension cho PostgreSQL, giúp biến PostgreSQL thành DB có thể lưu và tìm kiếm vectơ — hợp nếu bạn đã dùng Postgres và muốn tích hợp vector search “gọn nhẹ”.
*   Redis-stack (không phải là redis thuần), có project mẫu: [https://github.com/mvtcode/node-simple-typescript/tree/rag-redis](https://github.com/mvtcode/node-simple-typescript/tree/rag-redis)

Đã setup xong Mongodb, giờ quay lại với source code: [https://github.com/mvtcode/node-simple-typescript/tree/rag-mongodb-cloud](https://github.com/mvtcode/node-simple-typescript/tree/rag-mongodb-cloud)